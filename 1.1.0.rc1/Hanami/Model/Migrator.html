<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- These meta tags come first. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Use title if it's in the page YAML frontmatter -->
    <title>
      Class: Hanami::Model::Migrator
      
        &mdash; Hanami API docs | v1.1.0.rc1
    
    </title>

    <!-- Include the CSS -->
    
      <link rel="stylesheet" href="../../assets/toolkit-minimal.min.css" type="text/css" charset="utf-8" />
    
      <link rel="stylesheet" href="../../assets/site.css" type="text/css" charset="utf-8" />
    

    <link href="http://hanamirb.org/images/favicon.ico" rel="icon" type="image/ico">
    <link href="//fonts.googleapis.com/css?family=Roboto:100,300,400,700" rel="stylesheet">

  </head>
  <body>
    <nav class="navbar navbar-toggleable-md navbar-inverse fixed-top">
      <button class="navbar-toggler navbar-toggler-right hidden-lg-up" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <a class="navbar-brand" href="/">Hanami API docs</a>

      <div class="collapse navbar-collapse" id="navbarsExampleDefault">
        <ul class="navbar-nav mr-auto">
        </ul>

        <ul class="navbar-nav navbar-right">
          <li class="nav-item">
            <select id="select-version" class="form-control">
              ["<option value='/1.1.0.rc1'>v1.1.0.rc1</option>", "<option value='/1.0.0'>v1.0.0</option>"]
            </select>
          </li>
        </ul>
      </div>
    </nav>

    <div class="container-fluid">
      <div class="row">
        <nav class="col-sm-3 col-md-2 hidden-xs-down bg-faded sidebar">
          <iframe id="sidebar" src="../../method_list.html?1"></iframe>
        </nav>

        <main class="col-sm-9 offset-sm-3 col-md-10 offset-md-2 pt-3">
          <h1>Class: Hanami::Model::Migrator
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Hanami::Model::Migrator</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>gems/gems/hanami-model-1.1.0.rc1/lib/hanami/model/migrator.rb<span class="defines">,<br />
  gems/gems/hanami-model-1.1.0.rc1/lib/hanami/model/migrator/logger.rb,<br /> gems/gems/hanami-model-1.1.0.rc1/lib/hanami/model/migrator/adapter.rb,<br /> gems/gems/hanami-model-1.1.0.rc1/lib/hanami/model/migrator/connection.rb,<br /> gems/gems/hanami-model-1.1.0.rc1/lib/hanami/model/migrator/mysql_adapter.rb,<br /> gems/gems/hanami-model-1.1.0.rc1/lib/hanami/model/migrator/sqlite_adapter.rb,<br /> gems/gems/hanami-model-1.1.0.rc1/lib/hanami/model/migrator/postgres_adapter.rb</span>
</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Database schema migrator</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>0.4.0</p>
</div>
      
    </li>
  
</ul>

</div>






  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#apply-class_method" title="apply (class method)">.<strong>apply</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Migrate, dump schema, delete migrations.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create-class_method" title="create (class method)">.<strong>create</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Create database defined by current configuration.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#drop-class_method" title="drop (class method)">.<strong>drop</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Drop database defined by current configuration.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#migrate-class_method" title="migrate (class method)">.<strong>migrate</strong>(version: nil)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Migrate database schema.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#prepare-class_method" title="prepare (class method)">.<strong>prepare</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Prepare database: drop, create, load schema (if any), migrate.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#rollback-class_method" title="rollback (class method)">.<strong>rollback</strong>(steps: 1)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Rollback database schema.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#version-class_method" title="version (class method)">.<strong>version</strong>  &#x21d2; String, NilClass </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Return current database version timestamp.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="apply-class_method">
  
    .<strong>apply</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Migrate, dump schema, delete migrations.</p>

<p>This is an experimental feature. It may change or be removed in the future.</p>

<p>Actively developed applications accumulate tons of migrations. In the long
term they are hard to maintain and slow to execute.</p>

<p>“Apply” feature solves this problem.</p>

<p>It keeps an updated SQL file with the structure of the database. This file
can be used to create fresh databases for developer machines or during
testing. This is faster than to run dozen or hundred migrations.</p>

<p>When we use “apply”, it eliminates all the migrations that are no longer
necessary.</p>

<p>NOTE: Class level interface SHOULD be removed in Hanami 2.0</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Apply Migrations</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hanami/model</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hanami/model/migrator</span><span class='tstring_end'>&#39;</span></span>

<span class='const'><span class='object_link'><a href="../../Hanami.html" title="Hanami (module)">Hanami</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Model.html" title="Hanami::Model (module)">Model</a></span></span><span class='period'>.</span><span class='id identifier rubyid_configure'><span class='object_link'><a href="../Model.html#configure-class_method" title="Hanami::Model.configure (method)">configure</a></span></span> <span class='kw'>do</span>
  <span class='comment'># ...
</span>  <span class='id identifier rubyid_adapter'>adapter</span>    <span class='symbol'>:sql</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>postgres://localhost/foo</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_migrations'>migrations</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>db/migrations</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_schema'>schema</span>     <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>db/schema.sql</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span>

<span class='comment'># Reads all files from &quot;db/migrations&quot; and apply and delete them.
</span><span class='comment'># It generates an updated version of &quot;db/schema.sql&quot;
</span><span class='const'><span class='object_link'><a href="../../Hanami.html" title="Hanami (module)">Hanami</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Model.html" title="Hanami::Model (module)">Model</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Hanami::Model::Migrator (class)">Migrator</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply'>apply</span></code></pre>
    
  </div>

<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="MigrationError.html" title="Hanami::Model::MigrationError (class)">Hanami::Model::MigrationError</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if an error occurs</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>Configuration#adapter</li>
    
      <li><span class='object_link'><a href="Configuration.html#migrations-instance_method" title="Hanami::Model::Configuration#migrations (method)">Configuration#migrations</a></span></li>
    
  </ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>0.4.0</p>
</div>
      
    </li>
  
</ul>

</div><div class="source">
  <p class="source_link">Source:
    <button class="source_show">Show</button>
    |
    <a href="https://github.com/hanami/model/blob/v1.1.0.rc1/lib/hanami/model/migrator.rb#L204" target="_blank" class="github_url">on GitHub</a>
  </p>

  <table class="source_code">
    <tr>
      <td>
        <pre class="code"><span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_apply'>apply</span>
  <span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_apply'>apply</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  </table>
</div>

</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create-class_method">
  
    .<strong>create</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Create database defined by current configuration.</p>

<p>It&#39;s only implemented for the following databases:</p>
<ul><li>
<p>SQLite3</p>
</li><li>
<p>PostgreSQL</p>
</li><li>
<p>MySQL</p>
</li></ul>

<p>NOTE: Class level interface SHOULD be removed in Hanami 2.0</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hanami/model</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hanami/model/migrator</span><span class='tstring_end'>&#39;</span></span>

<span class='const'><span class='object_link'><a href="../../Hanami.html" title="Hanami (module)">Hanami</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Model.html" title="Hanami::Model (module)">Model</a></span></span><span class='period'>.</span><span class='id identifier rubyid_configure'><span class='object_link'><a href="../Model.html#configure-class_method" title="Hanami::Model.configure (method)">configure</a></span></span> <span class='kw'>do</span>
  <span class='comment'># ...
</span>  <span class='id identifier rubyid_adapter'>adapter</span> <span class='symbol'>:sql</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>postgres://localhost/foo</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span>

<span class='const'><span class='object_link'><a href="../../Hanami.html" title="Hanami (module)">Hanami</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Model.html" title="Hanami::Model (module)">Model</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Hanami::Model::Migrator (class)">Migrator</a></span></span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span> <span class='comment'># Creates `foo&#39; database</span></code></pre>
    
  </div>

<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="MigrationError.html" title="Hanami::Model::MigrationError (class)">Hanami::Model::MigrationError</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if an error occurs</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>Configuration#adapter</li>
    
  </ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>0.4.0</p>
</div>
      
    </li>
  
</ul>

</div><div class="source">
  <p class="source_link">Source:
    <button class="source_show">Show</button>
    |
    <a href="https://github.com/hanami/model/blob/v1.1.0.rc1/lib/hanami/model/migrator.rb#L45" target="_blank" class="github_url">on GitHub</a>
  </p>

  <table class="source_code">
    <tr>
      <td>
        <pre class="code"><span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span>
  <span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  </table>
</div>

</div>
    
      <div class="method_details ">
  <h3 class="signature " id="drop-class_method">
  
    .<strong>drop</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Drop database defined by current configuration.</p>

<p>It&#39;s only implemented for the following databases:</p>
<ul><li>
<p>SQLite3</p>
</li><li>
<p>PostgreSQL</p>
</li><li>
<p>MySQL</p>
</li></ul>

<p>NOTE: Class level interface SHOULD be removed in Hanami 2.0</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hanami/model</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hanami/model/migrator</span><span class='tstring_end'>&#39;</span></span>

<span class='const'><span class='object_link'><a href="../../Hanami.html" title="Hanami (module)">Hanami</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Model.html" title="Hanami::Model (module)">Model</a></span></span><span class='period'>.</span><span class='id identifier rubyid_configure'><span class='object_link'><a href="../Model.html#configure-class_method" title="Hanami::Model.configure (method)">configure</a></span></span> <span class='kw'>do</span>
  <span class='comment'># ...
</span>  <span class='id identifier rubyid_adapter'>adapter</span> <span class='symbol'>:sql</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>postgres://localhost/foo</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span>

<span class='const'><span class='object_link'><a href="../../Hanami.html" title="Hanami (module)">Hanami</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Model.html" title="Hanami::Model (module)">Model</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Hanami::Model::Migrator (class)">Migrator</a></span></span><span class='period'>.</span><span class='id identifier rubyid_drop'>drop</span> <span class='comment'># Drops `foo&#39; database</span></code></pre>
    
  </div>

<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="MigrationError.html" title="Hanami::Model::MigrationError (class)">Hanami::Model::MigrationError</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if an error occurs</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>Configuration#adapter</li>
    
  </ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>0.4.0</p>
</div>
      
    </li>
  
</ul>

</div><div class="source">
  <p class="source_link">Source:
    <button class="source_show">Show</button>
    |
    <a href="https://github.com/hanami/model/blob/v1.1.0.rc1/lib/hanami/model/migrator.rb#L75" target="_blank" class="github_url">on GitHub</a>
  </p>

  <table class="source_code">
    <tr>
      <td>
        <pre class="code"><span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_drop'>drop</span>
  <span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_drop'>drop</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  </table>
</div>

</div>
    
      <div class="method_details ">
  <h3 class="signature " id="migrate-class_method">
  
    .<strong>migrate</strong>(version: nil)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Migrate database schema</p>

<p>It&#39;s possible to migrate “down” by specifying a version (eg.
<code>&quot;20150610133853&quot;</code>)</p>

<p>NOTE: Class level interface SHOULD be removed in Hanami 2.0</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Migrate Up</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hanami/model</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hanami/model/migrator</span><span class='tstring_end'>&#39;</span></span>

<span class='const'><span class='object_link'><a href="../../Hanami.html" title="Hanami (module)">Hanami</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Model.html" title="Hanami::Model (module)">Model</a></span></span><span class='period'>.</span><span class='id identifier rubyid_configure'><span class='object_link'><a href="../Model.html#configure-class_method" title="Hanami::Model.configure (method)">configure</a></span></span> <span class='kw'>do</span>
  <span class='comment'># ...
</span>  <span class='id identifier rubyid_adapter'>adapter</span>    <span class='symbol'>:sql</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>postgres://localhost/foo</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_migrations'>migrations</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>db/migrations</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span>

<span class='comment'># Reads all files from &quot;db/migrations&quot; and apply them
</span><span class='const'><span class='object_link'><a href="../../Hanami.html" title="Hanami (module)">Hanami</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Model.html" title="Hanami::Model (module)">Model</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Hanami::Model::Migrator (class)">Migrator</a></span></span><span class='period'>.</span><span class='id identifier rubyid_migrate'>migrate</span></code></pre>
    
      
        <p class="example_title"><div class='inline'>
<p>Migrate Down</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hanami/model</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hanami/model/migrator</span><span class='tstring_end'>&#39;</span></span>

<span class='const'><span class='object_link'><a href="../../Hanami.html" title="Hanami (module)">Hanami</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Model.html" title="Hanami::Model (module)">Model</a></span></span><span class='period'>.</span><span class='id identifier rubyid_configure'><span class='object_link'><a href="../Model.html#configure-class_method" title="Hanami::Model.configure (method)">configure</a></span></span> <span class='kw'>do</span>
  <span class='comment'># ...
</span>  <span class='id identifier rubyid_adapter'>adapter</span>    <span class='symbol'>:sql</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>postgres://localhost/foo</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_migrations'>migrations</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>db/migrations</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span>

<span class='comment'># Reads all files from &quot;db/migrations&quot; and apply them
</span><span class='const'><span class='object_link'><a href="../../Hanami.html" title="Hanami (module)">Hanami</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Model.html" title="Hanami::Model (module)">Model</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Hanami::Model::Migrator (class)">Migrator</a></span></span><span class='period'>.</span><span class='id identifier rubyid_migrate'>migrate</span>

<span class='comment'># Migrate to a specific version
</span><span class='const'><span class='object_link'><a href="../../Hanami.html" title="Hanami (module)">Hanami</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Model.html" title="Hanami::Model (module)">Model</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Hanami::Model::Migrator (class)">Migrator</a></span></span><span class='period'>.</span><span class='id identifier rubyid_migrate'>migrate</span><span class='lparen'>(</span><span class='label'>version:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>20150610133853</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>version</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>NilClass</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>target version</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="MigrationError.html" title="Hanami::Model::MigrationError (class)">Hanami::Model::MigrationError</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if an error occurs</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>Configuration#adapter</li>
    
      <li><span class='object_link'><a href="Configuration.html#migrations-instance_method" title="Hanami::Model::Configuration#migrations (method)">Configuration#migrations</a></span></li>
    
      <li>Configuration#rollback</li>
    
  </ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>0.4.0</p>
</div>
      
    </li>
  
</ul>

</div><div class="source">
  <p class="source_link">Source:
    <button class="source_show">Show</button>
    |
    <a href="https://github.com/hanami/model/blob/v1.1.0.rc1/lib/hanami/model/migrator.rb#L124" target="_blank" class="github_url">on GitHub</a>
  </p>

  <table class="source_code">
    <tr>
      <td>
        <pre class="code"><span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_migrate'>migrate</span><span class='lparen'>(</span><span class='label'>version:</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_migrate'>migrate</span><span class='lparen'>(</span><span class='label'>version:</span> <span class='id identifier rubyid_version'>version</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  </table>
</div>

</div>
    
      <div class="method_details ">
  <h3 class="signature " id="prepare-class_method">
  
    .<strong>prepare</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Prepare database: drop, create, load schema (if any), migrate.</p>

<p>This is designed for development machines and testing mode. It works faster
if used with <code>apply</code>.</p>

<p>NOTE: Class level interface SHOULD be removed in Hanami 2.0</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Prepare Database</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hanami/model</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hanami/model/migrator</span><span class='tstring_end'>&#39;</span></span>

<span class='const'><span class='object_link'><a href="../../Hanami.html" title="Hanami (module)">Hanami</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Model.html" title="Hanami::Model (module)">Model</a></span></span><span class='period'>.</span><span class='id identifier rubyid_configure'><span class='object_link'><a href="../Model.html#configure-class_method" title="Hanami::Model.configure (method)">configure</a></span></span> <span class='kw'>do</span>
  <span class='comment'># ...
</span>  <span class='id identifier rubyid_adapter'>adapter</span>    <span class='symbol'>:sql</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>postgres://localhost/foo</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_migrations'>migrations</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>db/migrations</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span>

<span class='const'><span class='object_link'><a href="../../Hanami.html" title="Hanami (module)">Hanami</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Model.html" title="Hanami::Model (module)">Model</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Hanami::Model::Migrator (class)">Migrator</a></span></span><span class='period'>.</span><span class='id identifier rubyid_prepare'>prepare</span> <span class='comment'># =&gt; creates `foo&#39; and runs migrations</span></code></pre>
    
      
        <p class="example_title"><div class='inline'>
<p>Prepare Database (with schema dump)</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hanami/model</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hanami/model/migrator</span><span class='tstring_end'>&#39;</span></span>

<span class='const'><span class='object_link'><a href="../../Hanami.html" title="Hanami (module)">Hanami</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Model.html" title="Hanami::Model (module)">Model</a></span></span><span class='period'>.</span><span class='id identifier rubyid_configure'><span class='object_link'><a href="../Model.html#configure-class_method" title="Hanami::Model.configure (method)">configure</a></span></span> <span class='kw'>do</span>
  <span class='comment'># ...
</span>  <span class='id identifier rubyid_adapter'>adapter</span>    <span class='symbol'>:sql</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>postgres://localhost/foo</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_migrations'>migrations</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>db/migrations</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_schema'>schema</span>     <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>db/schema.sql</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span>

<span class='const'><span class='object_link'><a href="../../Hanami.html" title="Hanami (module)">Hanami</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Model.html" title="Hanami::Model (module)">Model</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Hanami::Model::Migrator (class)">Migrator</a></span></span><span class='period'>.</span><span class='id identifier rubyid_apply'><span class='object_link'><a href="#apply-class_method" title="Hanami::Model::Migrator.apply (method)">apply</a></span></span>   <span class='comment'># =&gt; updates schema dump
</span><span class='const'><span class='object_link'><a href="../../Hanami.html" title="Hanami (module)">Hanami</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Model.html" title="Hanami::Model (module)">Model</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Hanami::Model::Migrator (class)">Migrator</a></span></span><span class='period'>.</span><span class='id identifier rubyid_prepare'>prepare</span> <span class='comment'># =&gt; creates `foo&#39;, load schema and run pending migrations (if any)</span></code></pre>
    
  </div>

<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="MigrationError.html" title="Hanami::Model::MigrationError (class)">Hanami::Model::MigrationError</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if an error occurs</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#apply-class_method" title="Hanami::Model::Migrator.apply (method)">apply</a></span></li>
    
  </ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>0.4.0</p>
</div>
      
    </li>
  
</ul>

</div><div class="source">
  <p class="source_link">Source:
    <button class="source_show">Show</button>
    |
    <a href="https://github.com/hanami/model/blob/v1.1.0.rc1/lib/hanami/model/migrator.rb#L246" target="_blank" class="github_url">on GitHub</a>
  </p>

  <table class="source_code">
    <tr>
      <td>
        <pre class="code"><span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_prepare'>prepare</span>
  <span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_prepare'>prepare</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  </table>
</div>

</div>
    
      <div class="method_details ">
  <h3 class="signature " id="rollback-class_method">
  
    .<strong>rollback</strong>(steps: 1)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Rollback database schema</p>

<p>NOTE: Class level interface SHOULD be removed in Hanami 2.0</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Rollback</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hanami/model</span><span class='tstring_end'>&#39;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hanami/model/migrator</span><span class='tstring_end'>&#39;</span></span>

<span class='const'><span class='object_link'><a href="../../Hanami.html" title="Hanami (module)">Hanami</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Model.html" title="Hanami::Model (module)">Model</a></span></span><span class='period'>.</span><span class='id identifier rubyid_configure'><span class='object_link'><a href="../Model.html#configure-class_method" title="Hanami::Model.configure (method)">configure</a></span></span> <span class='kw'>do</span>
  <span class='comment'># ...
</span>  <span class='id identifier rubyid_adapter'>adapter</span>    <span class='symbol'>:sql</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>postgres://localhost/foo</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_migrations'>migrations</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>db/migrations</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span>

<span class='comment'># Reads all files from &quot;db/migrations&quot; and apply them
</span><span class='const'><span class='object_link'><a href="../../Hanami.html" title="Hanami (module)">Hanami</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Model.html" title="Hanami::Model (module)">Model</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Hanami::Model::Migrator (class)">Migrator</a></span></span><span class='period'>.</span><span class='id identifier rubyid_migrate'><span class='object_link'><a href="#migrate-class_method" title="Hanami::Model::Migrator.migrate (method)">migrate</a></span></span>

<span class='comment'># By default only rollback one version
</span><span class='const'><span class='object_link'><a href="../../Hanami.html" title="Hanami (module)">Hanami</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Model.html" title="Hanami::Model (module)">Model</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Hanami::Model::Migrator (class)">Migrator</a></span></span><span class='period'>.</span><span class='id identifier rubyid_rollback'>rollback</span>

<span class='comment'># Use a hash passing a number of versions to rollback, it will rollbacks those versions
</span><span class='const'><span class='object_link'><a href="../../Hanami.html" title="Hanami (module)">Hanami</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Model.html" title="Hanami::Model (module)">Model</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Hanami::Model::Migrator (class)">Migrator</a></span></span><span class='period'>.</span><span class='id identifier rubyid_rollback'>rollback</span><span class='lparen'>(</span><span class='label'>versions:</span> <span class='int'>2</span><span class='rparen'>)</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>steps</span>
      
      
        <span class='type'>(<tt>Number</tt>, <tt>NilClass</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>number of versions to rollback</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="MigrationError.html" title="Hanami::Model::MigrationError (class)">Hanami::Model::MigrationError</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>if an error occurs</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>Configuration#adapter</li>
    
      <li><span class='object_link'><a href="Configuration.html#migrations-instance_method" title="Hanami::Model::Configuration#migrations (method)">Configuration#migrations</a></span></li>
    
      <li>Configuration#migrate</li>
    
  </ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>1.1.0</p>
</div>
      
    </li>
  
</ul>

</div><div class="source">
  <p class="source_link">Source:
    <button class="source_show">Show</button>
    |
    <a href="https://github.com/hanami/model/blob/v1.1.0.rc1/lib/hanami/model/migrator.rb#L160" target="_blank" class="github_url">on GitHub</a>
  </p>

  <table class="source_code">
    <tr>
      <td>
        <pre class="code"><span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_rollback'>rollback</span><span class='lparen'>(</span><span class='label'>steps:</span> <span class='int'>1</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_rollback'>rollback</span><span class='lparen'>(</span><span class='label'>steps:</span> <span class='id identifier rubyid_steps'>steps</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  </table>
</div>

</div>
    
      <div class="method_details ">
  <h3 class="signature " id="version-class_method">
  
    .<strong>version</strong>  &#x21d2; <tt>String</tt>, <tt>NilClass</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Return current database version timestamp</p>

<p>If no migrations were ran, it returns <code>nil</code>.</p>

<p>NOTE: Class level interface SHOULD be removed in Hanami 2.0</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='comment'># Given last migrations is:
</span><span class='comment'>#  20150610133853_create_books.rb
</span>
<span class='const'><span class='object_link'><a href="../../Hanami.html" title="Hanami (module)">Hanami</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Model.html" title="Hanami::Model (module)">Model</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Hanami::Model::Migrator (class)">Migrator</a></span></span><span class='period'>.</span><span class='id identifier rubyid_version'>version</span> <span class='comment'># =&gt; &quot;20150610133853&quot;</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>, <tt>NilClass</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>current version, if previously migrated</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>0.4.0</p>
</div>
      
    </li>
  
</ul>

</div><div class="source">
  <p class="source_link">Source:
    <button class="source_show">Show</button>
    |
    <a href="https://github.com/hanami/model/blob/v1.1.0.rc1/lib/hanami/model/migrator.rb#L265" target="_blank" class="github_url">on GitHub</a>
  </p>

  <table class="source_code">
    <tr>
      <td>
        <pre class="code"><span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_version'>version</span>
  <span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_version'>version</span>
<span class='kw'>end</span></pre>
      </td>
    </tr>
  </table>
</div>

</div>
    
  </div>


        </main>
      </div>
    </div>

    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>

    <!-- Include jQuery (required) and the JS -->
    
    
      <script type="text/javascript" charset="utf-8" src="../../assets/toolkit.min.js"></script>
    
      <script type="text/javascript" charset="utf-8" src="../../assets/site.js"></script>
    
  </body>
</html>
